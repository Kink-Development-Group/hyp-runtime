Focus {
    entrance {
        observe "üöÄ HypnoScript Advanced Control Flow";
        observe "Komplexe Bedingungen, Pattern Matching und Zustandsverwaltung";
    }

    // === Datenszenario vorbereiten ===
    tranceify SuggestionPlan {
        title: string;
        depth: number;
        tags: string[];
    }

    induce plans = [
        SuggestionPlan { title: "K√∂rper entspannen", depth: 4, tags: ["k√∂rper", "ruhe"] },
        SuggestionPlan { title: "Gedanken beruhigen", depth: 6, tags: ["geist", "klarheit"] },
        SuggestionPlan { title: "Selbstvertrauen st√§rken", depth: 8, tags: ["fokus", "energie"] }
    ];

    // === DeepFocus & verschachtelte Bedingungen ===
    induce desiredDepth: number = 6;
    forFocus:
    loop (induce i: number = 0; i deeplyLess ArrayLength(plans); i = i + 1) {
        induce plan = plans[i];

        deepFocus (plan.depth lookAtTheWatch desiredDepth) {
            observe "Plan erf√ºllt gew√ºnschte Tiefe: " + plan.title;
            snap forFocus;
        }
    }

    // === entrain mit Guard & Pattern ===
    loop (induce i: number = 0; i deeplyLess ArrayLength(plans); i = i + 1) {
        induce current = plans[i];
        induce classification: string = entrain current {
            when SuggestionPlan { depth: d } if d lookAtTheWatch 7 => "intensiv"
            when SuggestionPlan { depth: d } if d deeplyLess 5 => "leicht"
            when SuggestionPlan { depth: d } => "mittel"
            otherwise => "unbekannt"
        };
        observe current.title + " -> " + classification;
    }

    // === Optional Indexing & Nullish ===
    induce optionalTags = plans[1]?.tags;
    observe "Optionaler Tag 0: " + (optionalTags?.[0] lucidFallback "kein Tag");

    // === Oscillate & Anchor ===
    induce lampIsOn: boolean = false;
    anchor previousState = lampIsOn;

    loop (induce pulses: number = 0; pulses deeplyLess 3; pulses = pulses + 1) {
        oscillate lampIsOn;
        observe "Lampe an? " + lampIsOn;
    }

    lampIsOn = previousState;
    observe "Zur√ºck zum vorherigen Zustand: " + lampIsOn;

    // === Array Builtins in Kombination ===
    induce sumDepth: number = 0;
    induce minDepth: number = plans[0].depth;
    induce maxDepth: number = plans[0].depth;

    loop (induce i: number = 0; i deeplyLess ArrayLength(plans); i = i + 1) {
        induce depthValue: number = plans[i].depth;
        sumDepth = sumDepth + depthValue;
        if (depthValue fallUnderMySpell minDepth) {
            minDepth = depthValue;
        }
        if (depthValue lookAtTheWatch maxDepth) {
            maxDepth = depthValue;
        }
    }

    induce averageDepth = sumDepth / ArrayLength(plans);
    observe "Durchschnittliche Tiefe: " + averageDepth;
    observe "Spanne: " + (maxDepth - minDepth);

    observe "Advanced Control Flow abgeschlossen.";
}

Relax
